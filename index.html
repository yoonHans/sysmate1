<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì–¼ë§ˆë‚´ PRO - ë§ì¶¤ ê²½ì¡°ì‚¬ ë§¤ë‹ˆì €</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Pretendard:wght@400;600;700&display=swap');
        body { font-family: 'Pretendard', sans-serif; background: #f8fafc; }
        .step-content { display: none; }
        .step-content.active { display: block; animation: fadeIn 0.4s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .extra-btn.active { background-color: #2563eb; color: white; border-color: #2563eb; }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">

    <div class="w-full max-w-lg bg-white rounded-3xl shadow-2xl overflow-hidden">
        <div id="progressContainer" class="h-2 bg-gray-100 hidden">
            <div id="progressBar" class="h-full bg-blue-600 transition-all duration-500" style="width: 0%;"></div>
        </div>

        <div class="p-8">
            <div id="mainMenu" class="step-content active text-center">
                <h1 class="text-3xl font-black text-gray-800 mb-2">ì–¼ë§ˆë‚´ PRO ğŸ’°</h1>
                <p class="text-gray-500 mb-10 text-sm">ê²½ì¡°ì‚¬ ê³ ë¯¼, ê¸°ë¡ë¶€í„° ê³„ì‚°ê¹Œì§€ í•œë²ˆì—</p>
                <div class="grid grid-cols-1 gap-4">
                    <button onclick="startGuide()" class="group p-6 border-2 border-blue-100 rounded-2xl hover:border-blue-500 hover:bg-blue-50 transition-all text-left">
                        <span class="text-3xl mb-2 block">ğŸ’</span>
                        <p class="font-bold text-xl group-hover:text-blue-600">ì¶•ì˜ê¸ˆ ê°€ì´ë“œ</p>
                        <p class="text-xs text-gray-400">ìƒí™©ì— ë§ëŠ” ì ì • ê¸ˆì•¡ ê³„ì‚°ê¸°</p>
                    </button>
                    <button onclick="openHistory()" class="group p-6 border-2 border-green-100 rounded-2xl hover:border-green-500 hover:bg-green-50 transition-all text-left">
                        <span class="text-3xl mb-2 block">ğŸ“–</span>
                        <p class="font-bold text-xl group-hover:text-green-600">ë‚˜ì˜ ê²½ì¡°ì‚¬ ì¥ë¶€</p>
                        <p class="text-xs text-gray-400">ì§€ì¸ ë‚´ì—­ ê¸°ë¡ ë° ë¬¼ê°€ ê°€ì¹˜ í™•ì¸</p>
                    </button>
                    <button onclick="openBoard()" class="group p-6 border-2 border-purple-100 rounded-2xl hover:border-purple-500 hover:bg-purple-50 transition-all text-left">
                        <span class="text-3xl mb-2 block">ğŸ’¬</span>
                        <p class="font-bold text-xl group-hover:text-purple-600">ì†Œí†µë°©</p>
                        <p class="text-xs text-gray-400">ê²½ì¡°ì‚¬ ê´€ë ¨ ê¸€ì„ ê°€ë³ê²Œ ì ì–´ë³´ê¸°</p>
                    </button>
                </div>

                <div class="mt-10 text-[11px] text-gray-400">
                    ë¬¸ì˜ ë©”ì¼ :
                    <a href="mailto:ebc7412@naver.com" class="underline hover:text-gray-600">ebc7412@naver.com</a>
                </div>
            </div>

            <div id="historyStep" class="step-content">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold">ë‚˜ì˜ ì¥ë¶€</h2>
                    <button onclick="showAddForm()" class="text-xs bg-blue-600 text-white px-3 py-1.5 rounded-full">+ ì¶”ê°€</button>
                </div>
                <div id="addForm" class="hidden bg-gray-50 p-4 rounded-2xl mb-6 border border-gray-100">
                    <div class="grid grid-cols-2 gap-2 mb-2">
                        <input type="text" id="hName" placeholder="ì´ë¦„" class="p-3 border rounded-xl text-sm">
                        <input type="number" id="hYear" placeholder="ì—°ë„(ì˜ˆ: 2015)" class="p-3 border rounded-xl text-sm">
                    </div>
                    <div class="grid grid-cols-2 gap-2 mb-3">
                        <select id="hEvent" class="p-3 border rounded-xl text-sm bg-white">
                            <option value="ê²°í˜¼ì‹">ê²°í˜¼ì‹</option>
                            <option value="ì¥ë¡€ì‹">ì¥ë¡€ì‹</option>
                            <option value="ëŒì”ì¹˜">ëŒì”ì¹˜</option>
                        </select>
                        <input type="number" id="hAmount" placeholder="ê¸ˆì•¡(ë§Œì›)" class="p-3 border rounded-xl text-sm">
                    </div>
                    <button onclick="saveHistory()" class="w-full bg-blue-600 text-white py-3 rounded-xl text-sm font-bold">ë‚´ì—­ ì €ì¥</button>
                </div>
                <div id="historyList" class="space-y-3 max-h-80 overflow-y-auto pr-1"></div>
                <button onclick="goHome()" class="w-full mt-6 py-3 text-gray-400 font-medium">ì²˜ìŒìœ¼ë¡œ</button>
            </div>

            <div id="boardStep" class="step-content">
                <div class="flex justify-between items-center mb-6">
                    <div>
                        <h2 class="text-2xl font-bold">ì†Œí†µë°©</h2>
                        <p class="text-xs text-gray-400 mt-1">ê°„ë‹¨ ê²Œì‹œíŒ Â· ê¸°ê¸°(ë¸Œë¼ìš°ì €) ë‚´ ì €ì¥</p>
                    </div>
                    <button onclick="toggleWriteForm()" class="text-xs bg-purple-600 text-white px-3 py-1.5 rounded-full">+ ê¸€ì“°ê¸°</button>
                </div>

                <div id="writeForm" class="hidden bg-gray-50 p-4 rounded-2xl mb-6 border border-gray-100">
                    <div class="grid grid-cols-2 gap-2 mb-2">
                        <input type="text" id="bName" placeholder="ë‹‰ë„¤ì„(ì„ íƒ)" class="p-3 border rounded-xl text-sm">
                        <select id="bCategory" class="p-3 border rounded-xl text-sm bg-white">
                            <option value="ì¡ë‹´">ì¡ë‹´</option>
                            <option value="ê²°í˜¼ì‹">ê²°í˜¼ì‹</option>
                            <option value="ì¥ë¡€ì‹">ì¥ë¡€ì‹</option>
                            <option value="ëŒì”ì¹˜">ëŒì”ì¹˜</option>
                            <option value="ê¿€íŒ">ê¿€íŒ</option>
                        </select>
                    </div>
                    <input type="text" id="bTitle" placeholder="ì œëª©" class="w-full p-3 border rounded-xl text-sm mb-2">
                    <textarea id="bContent" placeholder="ë‚´ìš©(ê°„ë‹¨í•˜ê²Œ)" class="w-full p-3 border rounded-xl text-sm h-28 resize-none mb-3"></textarea>
                    <button onclick="savePost()" class="w-full bg-purple-600 text-white py-3 rounded-xl text-sm font-bold">ê¸€ ë“±ë¡</button>
                </div>

                <div id="boardList" class="space-y-3 max-h-80 overflow-y-auto pr-1"></div>
                <button onclick="goHome()" class="w-full mt-6 py-3 text-gray-400 font-medium">ì²˜ìŒìœ¼ë¡œ</button>
            </div>

            <div id="postDetailStep" class="step-content">
                <div class="flex justify-between items-center mb-4">
                    <button onclick="backToBoard()" class="text-sm text-gray-500 hover:text-gray-700">â† ëª©ë¡</button>
                    <button id="deletePostBtn" onclick="deleteCurrentPost()" class="text-xs text-red-500 hover:text-red-700">ì‚­ì œ</button>
                </div>

                <div class="bg-white border rounded-2xl p-5 shadow-sm mb-4">
                    <div class="flex items-start justify-between gap-3">
                        <div class="flex-1">
                            <h3 id="detailTitle" class="text-xl font-extrabold text-gray-900"></h3>
                            <p id="detailMeta" class="text-[11px] text-gray-400 mt-2"></p>
                        </div>
                    </div>
                    <div id="detailContent" class="mt-4 text-sm text-gray-700 leading-relaxed whitespace-pre-wrap"></div>
                </div>

                <div class="bg-gray-50 border border-gray-100 rounded-2xl p-4 mb-3">
                    <p class="text-sm font-bold text-gray-800 mb-3">ëŒ“ê¸€</p>
                    <div class="grid grid-cols-2 gap-2 mb-2">
                        <input type="text" id="cName" placeholder="ë‹‰ë„¤ì„(ì„ íƒ)" class="p-3 border rounded-xl text-sm bg-white">
                        <button onclick="addComment()" class="bg-gray-800 text-white rounded-xl text-sm font-bold">ëŒ“ê¸€ ë“±ë¡</button>
                    </div>
                    <textarea id="cContent" placeholder="ëŒ“ê¸€ ë‚´ìš©" class="w-full p-3 border rounded-xl text-sm h-20 resize-none bg-white"></textarea>
                </div>

                <div id="commentList" class="space-y-2 max-h-60 overflow-y-auto pr-1"></div>
                <button onclick="backToBoard()" class="w-full mt-6 py-3 text-gray-400 font-medium">ëª©ë¡ìœ¼ë¡œ</button>
            </div>

            <div id="step1" class="step-content">
                <div class="flex justify-between text-xs font-semibold text-gray-400 mb-6"><span>1/3 ë‹¨ê³„</span><span>ë‹¨ìœ„: ë§Œì›</span></div>
                <h2 class="text-2xl font-bold mb-2">ì–´ë–¤ ê²½ì¡°ì‚¬ì¸ê°€ìš”?</h2>
                <div class="grid grid-cols-1 gap-3 mt-8">
                    <button onclick="nextStep(1, {event: 'wedding'})" class="flex items-center p-5 border-2 rounded-2xl hover:bg-blue-50"><span class="text-2xl mr-4">ğŸ’</span><div class="text-left font-bold">ê²°í˜¼ì‹</div></button>
                    <button onclick="nextStep(1, {event: 'funeral'})" class="flex items-center p-5 border-2 rounded-2xl hover:bg-blue-50"><span class="text-2xl mr-4">ğŸ™</span><div class="text-left font-bold">ì¥ë¡€ì‹</div></button>
                    <button onclick="nextStep(1, {event: 'baby'})" class="flex items-center p-5 border-2 rounded-2xl hover:bg-blue-50"><span class="text-2xl mr-4">ğŸ‘¶</span><div class="text-left font-bold">ëŒì”ì¹˜</div></button>
                </div>
            </div>

            <div id="step2" class="step-content">
                <div class="flex justify-between text-xs font-semibold text-gray-400 mb-6"><span>2/3 ë‹¨ê³„</span></div>
                <h2 class="text-2xl font-bold mb-6">ìƒëŒ€ë°©ê³¼ ì–¼ë§ˆë‚˜ ì¹œí•œê°€ìš”?</h2>
                <div class="space-y-3">
                    <button onclick="nextStep(2, {score: 10})" class="w-full p-4 border-2 rounded-xl text-left hover:bg-gray-50 font-medium">ê±°ì˜ ê°€ì¡± ê°™ì€ ì‚¬ì´ (ì ˆì¹œ)</button>
                    <button onclick="nextStep(2, {score: 7})" class="w-full p-4 border-2 rounded-xl text-left hover:bg-gray-50 font-medium">ìì£¼ ì†Œí†µí•˜ëŠ” ë™ë£Œ/ì¹œêµ¬</button>
                    <button onclick="nextStep(2, {score: 4})" class="w-full p-4 border-2 rounded-xl text-left hover:bg-gray-50 font-medium">ê°€ë” ì—°ë½í•˜ëŠ” ì§€ì¸</button>
                    <button onclick="nextStep(2, {score: 1})" class="w-full p-4 border-2 rounded-xl text-left hover:bg-gray-50 font-medium">ì—°ë½ì´ ëœ¸í–ˆë˜ ì‚¬ì´</button>
                </div>
                <button onclick="prevStep(2)" class="w-full mt-6 py-3 text-gray-400">ì´ì „ ë‹¨ê³„</button>
            </div>

            <div id="step3" class="step-content">
                <div class="flex justify-between text-xs font-semibold text-gray-400 mb-6"><span>3/3 ë‹¨ê³„</span></div>
                <h2 class="text-2xl font-bold mb-6">ìƒì„¸ ìƒí™©ì„ ì•Œë ¤ì£¼ì„¸ìš”.</h2>
                <div class="space-y-6">
                    <div>
                        <p class="text-sm font-semibold text-gray-700 mb-3">ë™í–‰ ì¸ì› (ë³¸ì¸ í¬í•¨)</p>
                        <div class="grid grid-cols-3 gap-2">
                            <button onclick="setExtra('ppl', 1, this)" class="extra-btn py-3 border rounded-xl active">1ëª…</button>
                            <button onclick="setExtra('ppl', 2, this)" class="extra-btn py-3 border rounded-xl">2ëª…</button>
                            <button onclick="setExtra('ppl', 3, this)" class="extra-btn py-3 border rounded-xl">3ëª… ì´ìƒ</button>
                        </div>
                    </div>
                    <div>
                        <p id="eatLabel" class="text-sm font-semibold text-gray-700 mb-3">ì‹ì‚¬ ì—¬ë¶€</p>
                        <div class="flex gap-2">
                            <button onclick="setExtra('eat', 'yes', this)" class="extra-btn flex-1 py-3 border rounded-xl active">ì‹ì‚¬ í•¨</button>
                            <button onclick="setExtra('eat', 'no', this)" class="extra-btn flex-1 py-3 border rounded-xl">ì•ˆ í•¨ / ë‹µë¡€í’ˆ</button>
                        </div>
                    </div>
                    <button onclick="showResult()" class="w-full py-4 bg-blue-600 text-white rounded-2xl font-bold shadow-lg">ê²°ê³¼ í™•ì¸í•˜ê¸°</button>
                    <button onclick="prevStep(3)" class="w-full py-2 text-gray-400">ì´ì „ ë‹¨ê³„</button>
                </div>
            </div>

            <div id="resultStep" class="step-content text-center">
                <div class="py-10">
                    <p class="text-gray-500 font-medium mb-2">ê°€ì¥ ì ì ˆí•œ ê¸ˆì•¡ì€</p>
                    <div class="text-6xl font-black text-blue-600 mb-4"><span id="totalAmount">0</span>ë§Œì›</div>
                    <p id="rangeText" class="text-sm text-gray-400 mb-8"></p>
                    <div id="analysisBox" class="bg-blue-50 p-5 rounded-2xl text-left text-sm text-blue-800 leading-relaxed"></div>
                </div>
                <button onclick="goHome()" class="w-full py-4 bg-gray-800 text-white rounded-xl font-bold">ë©”ì¸ìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
            </div>
        </div>
    </div>

    <script>
        let userData = { event: '', score: 0, ppl: 1, eat: 'yes' };
        let history = JSON.parse(localStorage.getItem('myGyeongjo')) || [];
        let boardPosts = JSON.parse(localStorage.getItem('gyeongjoBoard')) || [];
        let currentPostId = null;

        function goHome() {
            document.querySelectorAll('.step-content').forEach(s => s.classList.remove('active'));
            document.getElementById('mainMenu').classList.add('active');
            document.getElementById('progressContainer').classList.add('hidden');
        }

        function startGuide() {
            userData = { event: '', score: 0, ppl: 1, eat: 'yes' }; // ë°ì´í„° ì´ˆê¸°í™”
            document.getElementById('mainMenu').classList.remove('active');
            document.getElementById('step1').classList.add('active');
            document.getElementById('progressContainer').classList.remove('hidden');
            updateProgress(1);
        }

        function nextStep(current, data) {
            userData = { ...userData, ...data };
            document.getElementById(`step${current}`).classList.remove('active');
            document.getElementById(`step${current+1}`).classList.add('active');
            updateProgress(current + 1);
        }

        function prevStep(current) {
            document.getElementById(`step${current}`).classList.remove('active');
            document.getElementById(`step${current-1}`).classList.add('active');
            updateProgress(current - 1);
        }

        function setExtra(key, val, el) {
            userData[key] = val;
            el.parentElement.querySelectorAll('button').forEach(b => b.classList.remove('active'));
            el.classList.add('active');
        }

        function updateProgress(step) {
            document.getElementById('progressBar').style.width = (step / 3) * 100 + '%';
        }

        // --- ê³„ì‚° ë¡œì§ ---
        function showResult() {
            const { event, score, ppl, eat } = userData;
            let base = 5;
            if (score >= 10) base = 20;
            else if (score >= 7) base = 10;
            else if (score >= 4) base = 7;

            if (event === 'baby') base = Math.max(5, base - 2);
            if (event === 'funeral') base = Math.min(base, 15);

            let final = base;
            const mealCost = event === 'wedding' ? 7 : 5;
            if (eat === 'yes') {
                final = Math.max(final, ppl * mealCost);
                if (event === 'wedding' && score >= 4) final = Math.max(final, 10);
            }

            final = Math.ceil(final / 5) * 5;
            
            document.getElementById('totalAmount').innerText = final;
            document.getElementById('rangeText').innerText = `ê¶Œì¥ ë²”ìœ„: ${Math.max(5, final-5)}~${final+5}ë§Œì›`;
            document.getElementById('analysisBox').innerHTML = `<ul class='list-disc pl-5'><li>ìµœê·¼ ë¬¼ê°€ì™€ ì‹ëŒ€(${ppl}ì¸)ë¥¼ ë°˜ì˜í–ˆìŠµë‹ˆë‹¤.</li><li>ê´€ê³„ì˜ ê¹Šì´ë¥¼ ìµœìš°ì„ ìœ¼ë¡œ ê³ ë ¤í–ˆìŠµë‹ˆë‹¤.</li></ul>`;
            
            document.getElementById('step3').classList.remove('active');
            document.getElementById('resultStep').classList.add('active');
        }

        // --- ì¥ë¶€ ê¸°ëŠ¥ ---
        function openHistory() {
            document.getElementById('mainMenu').classList.remove('active');
            document.getElementById('historyStep').classList.add('active');
            renderHistory();
        }

        function showAddForm() { document.getElementById('addForm').classList.toggle('hidden'); }

        function saveHistory() {
            const name = document.getElementById('hName').value;
            const year = parseInt(document.getElementById('hYear').value);
            const event = document.getElementById('hEvent').value;
            const amount = parseInt(document.getElementById('hAmount').value);
            if(!name || !year || !amount) return alert('ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
            history.unshift({ name, year, event, amount });
            localStorage.setItem('myGyeongjo', JSON.stringify(history));
            document.getElementById('addForm').classList.add('hidden');
            renderHistory();
        }

        function renderHistory() {
            const currentYear = 2026; // í˜„ì¬ ì—°ë„ ê¸°ì¤€
            document.getElementById('historyList').innerHTML = history.map((item, index) => {
                const years = currentYear - item.year;
                const nowVal = Math.round(item.amount * Math.pow(1.03, years)); // ì—° 3% ë¬¼ê°€ìƒìŠ¹ ë³µë¦¬
                return `
                    <div class="p-4 bg-white border rounded-2xl shadow-sm">
                        <div class="flex justify-between items-center">
                            <div class="flex-1">
                                <p class="text-[10px] text-blue-500 font-bold mb-1">${item.year}ë…„ Â· ${item.event}</p>
                                <h3 class="font-extrabold text-gray-800">${item.name}</h3>
                            </div>
                            <div class="text-right mr-3">
                                <p class="text-lg font-black text-gray-800">${item.amount}ë§Œì›</p>
                                <p class="text-[10px] text-orange-500">í˜„ì¬ ê°€ì¹˜ ì•½ ${nowVal}ë§Œì›</p>
                            </div>
                            <button onclick="deleteHistory(${index})" class="text-red-500 hover:text-red-700 hover:bg-red-50 p-2 rounded-lg transition-colors" title="ì‚­ì œ">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                                </svg>
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function deleteHistory(index) {
            if (confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                history.splice(index, 1);
                localStorage.setItem('myGyeongjo', JSON.stringify(history));
                renderHistory();
            }
        }

        // --- ì†Œí†µë°©(ê°„ë‹¨ ê²Œì‹œíŒ) ---
        function openBoard() {
            document.getElementById('mainMenu').classList.remove('active');
            document.getElementById('boardStep').classList.add('active');
            document.getElementById('writeForm').classList.add('hidden');
            renderBoard();
        }

        function toggleWriteForm() {
            document.getElementById('writeForm').classList.toggle('hidden');
        }

        function persistBoard() {
            localStorage.setItem('gyeongjoBoard', JSON.stringify(boardPosts));
        }

        function formatKoreanDate(ts) {
            try {
                return new Date(ts).toLocaleString('ko-KR', { year: '2-digit', month: '2-digit', day: '2-digit', hour: '2-digit', minute: '2-digit' });
            } catch {
                return '';
            }
        }

        function savePost() {
            const name = (document.getElementById('bName').value || '').trim() || 'ìµëª…';
            const category = document.getElementById('bCategory').value;
            const title = (document.getElementById('bTitle').value || '').trim();
            const content = (document.getElementById('bContent').value || '').trim();

            if (!title || !content) return alert('ì œëª©ê³¼ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');

            const post = {
                id: String(Date.now()) + '-' + Math.random().toString(16).slice(2),
                name,
                category,
                title,
                content,
                createdAt: Date.now(),
                views: 0,
                comments: []
            };

            boardPosts.unshift(post);
            persistBoard();

            document.getElementById('bTitle').value = '';
            document.getElementById('bContent').value = '';
            document.getElementById('writeForm').classList.add('hidden');
            renderBoard();
        }

        function renderBoard() {
            const el = document.getElementById('boardList');
            if (!boardPosts.length) {
                el.innerHTML = `
                    <div class="p-6 text-center text-sm text-gray-400 bg-gray-50 border border-gray-100 rounded-2xl">
                        ì•„ì§ ê¸€ì´ ì—†ì–´ìš”. ì²« ê¸€ì„ ë‚¨ê²¨ë³´ì„¸ìš”!
                    </div>
                `;
                return;
            }

            el.innerHTML = boardPosts.map(post => `
                <button onclick="openPost('${post.id}')" class="w-full text-left p-4 bg-white border rounded-2xl shadow-sm hover:bg-gray-50 transition-colors">
                    <div class="flex items-center justify-between gap-3">
                        <div class="flex-1 min-w-0">
                            <div class="flex items-center gap-2 mb-1">
                                <span class="text-[10px] font-bold px-2 py-0.5 rounded-full bg-purple-50 text-purple-600 border border-purple-100">${post.category}</span>
                                <span class="text-[10px] text-gray-400">${formatKoreanDate(post.createdAt)}</span>
                            </div>
                            <p class="font-extrabold text-gray-900 truncate">${post.title}</p>
                            <p class="text-[11px] text-gray-400 mt-1 truncate">${post.name} Â· ì¡°íšŒ ${post.views} Â· ëŒ“ê¸€ ${(post.comments || []).length}</p>
                        </div>
                        <span class="text-gray-300 text-lg">â€º</span>
                    </div>
                </button>
            `).join('');
        }

        function openPost(id) {
            const post = boardPosts.find(p => p.id === id);
            if (!post) return alert('ê¸€ì„ ì°¾ì„ ìˆ˜ ì—†ì–´ìš”.');

            currentPostId = id;
            post.views = (post.views || 0) + 1;
            persistBoard();

            document.getElementById('boardStep').classList.remove('active');
            document.getElementById('postDetailStep').classList.add('active');

            document.getElementById('detailTitle').innerText = post.title;
            document.getElementById('detailMeta').innerText = `${post.category} Â· ${post.name} Â· ${formatKoreanDate(post.createdAt)} Â· ì¡°íšŒ ${post.views}`;
            document.getElementById('detailContent').innerText = post.content;

            document.getElementById('cName').value = '';
            document.getElementById('cContent').value = '';
            renderComments();
        }

        function backToBoard() {
            document.getElementById('postDetailStep').classList.remove('active');
            document.getElementById('boardStep').classList.add('active');
            renderBoard();
        }

        function deleteCurrentPost() {
            if (!currentPostId) return;
            const post = boardPosts.find(p => p.id === currentPostId);
            if (!post) return;

            if (!confirm('ì´ ê¸€ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            boardPosts = boardPosts.filter(p => p.id !== currentPostId);
            persistBoard();
            currentPostId = null;
            backToBoard();
        }

        function addComment() {
            if (!currentPostId) return;
            const post = boardPosts.find(p => p.id === currentPostId);
            if (!post) return;

            const name = (document.getElementById('cName').value || '').trim() || 'ìµëª…';
            const content = (document.getElementById('cContent').value || '').trim();
            if (!content) return alert('ëŒ“ê¸€ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');

            post.comments = post.comments || [];
            post.comments.unshift({
                id: String(Date.now()) + '-' + Math.random().toString(16).slice(2),
                name,
                content,
                createdAt: Date.now()
            });
            persistBoard();
            document.getElementById('cContent').value = '';
            renderComments();
        }

        function deleteComment(commentId) {
            if (!currentPostId) return;
            const post = boardPosts.find(p => p.id === currentPostId);
            if (!post) return;

            if (!confirm('ëŒ“ê¸€ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            post.comments = (post.comments || []).filter(c => c.id !== commentId);
            persistBoard();
            renderComments();
        }

        function renderComments() {
            const post = boardPosts.find(p => p.id === currentPostId);
            const el = document.getElementById('commentList');
            if (!post) { el.innerHTML = ''; return; }

            const comments = post.comments || [];
            if (!comments.length) {
                el.innerHTML = `<div class="p-4 text-center text-sm text-gray-400">ì•„ì§ ëŒ“ê¸€ì´ ì—†ì–´ìš”.</div>`;
                return;
            }

            el.innerHTML = comments.map(c => `
                <div class="p-3 bg-white border rounded-2xl">
                    <div class="flex justify-between items-center mb-1">
                        <p class="text-[11px] font-bold text-gray-700">${c.name} <span class="text-[10px] font-normal text-gray-400">Â· ${formatKoreanDate(c.createdAt)}</span></p>
                        <button onclick="deleteComment('${c.id}')" class="text-[11px] text-red-400 hover:text-red-600">ì‚­ì œ</button>
                    </div>
                    <p class="text-sm text-gray-700 whitespace-pre-wrap">${c.content}</p>
                </div>
            `).join('');
        }
    </script>
</body>
</html>
