<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì–¼ë§ˆë‚´ PRO - ë§ì¶¤ ê²½ì¡°ì‚¬ ê°€ì´ë“œ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Pretendard:wght@400;600;700&display=swap');
        body { font-family: 'Pretendard', sans-serif; background: #f8fafc; }
        .step-content { display: none; }
        .step-content.active { display: block; animation: fadeIn 0.4s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .extra-btn.active { background-color: #2563eb; color: white; border-color: #2563eb; }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">

    <div class="w-full max-w-lg bg-white rounded-3xl shadow-2xl overflow-hidden">
        <div class="h-2 bg-gray-100 flex">
            <div id="progressBar" class="h-full bg-blue-600 transition-all duration-500" style="width: 25%;"></div>
        </div>

        <div class="p-8">
            <div class="flex items-center justify-between mb-6">
                <p id="stepCounter" class="text-xs font-semibold text-gray-400">1/3</p>
                <p class="text-xs text-gray-400">ë‹¨ìœ„: ë§Œì›</p>
            </div>
            <div id="step1" class="step-content active">
                <h2 class="text-2xl font-bold mb-2">ì–´ë–¤ ê²½ì¡°ì‚¬ì¸ê°€ìš”?</h2>
                <p class="text-gray-500 mb-8 text-sm">í–‰ì‚¬ ì„±ê²©ì— ë”°ë¼ ê¸°ì¤€ ê¸ˆì•¡ì´ ë‹¬ë¼ì§‘ë‹ˆë‹¤.</p>
                <div class="grid grid-cols-1 gap-4">
                    <button type="button" onclick="nextStep(1, {event: 'wedding'})" class="flex items-center p-5 border-2 rounded-2xl hover:border-blue-400 hover:bg-blue-50 transition-all focus:outline-none focus:ring-2 focus:ring-blue-200">
                        <span class="text-3xl mr-4">ğŸ’</span>
                        <div class="text-left"><p class="font-bold">ê²°í˜¼ì‹</p><p class="text-xs text-gray-400">ì‹ëŒ€ì™€ ì¥ì†Œ ê³ ë ¤</p></div>
                    </button>
                    <button type="button" onclick="nextStep(1, {event: 'funeral'})" class="flex items-center p-5 border-2 rounded-2xl hover:border-blue-400 hover:bg-blue-50 transition-all focus:outline-none focus:ring-2 focus:ring-blue-200">
                        <span class="text-3xl mr-4">ğŸ™</span>
                        <div class="text-left"><p class="font-bold">ì¥ë¡€ì‹</p><p class="text-xs text-gray-400">ì¡°ì˜ì™€ ìœ„ë¡œì˜ ë§ˆìŒ</p></div>
                    </button>
                    <button type="button" onclick="nextStep(1, {event: 'baby'})" class="flex items-center p-5 border-2 rounded-2xl hover:border-blue-400 hover:bg-blue-50 transition-all focus:outline-none focus:ring-2 focus:ring-blue-200">
                        <span class="text-3xl mr-4">ğŸ‘¶</span>
                        <div class="text-left"><p class="font-bold">ëŒì”ì¹˜</p><p class="text-xs text-gray-400">ì¶•í•˜ì™€ ì•„ì´ì˜ ì²« ìƒì¼</p></div>
                    </button>
                </div>
            </div>

            <div id="step2" class="step-content">
                <h2 class="text-2xl font-bold mb-6">ìƒëŒ€ë°©ê³¼ ì–¼ë§ˆë‚˜ ì¹œí•œê°€ìš”?</h2>
                <div class="space-y-3">
                    <button type="button" onclick="nextStep(2, {score: 10})" class="w-full p-4 border-2 rounded-xl text-left hover:bg-gray-50 font-medium focus:outline-none focus:ring-2 focus:ring-blue-200">ê±°ì˜ ê°€ì¡± ê°™ì€ ì‚¬ì´ (ì ˆì¹œ)</button>
                    <button type="button" onclick="nextStep(2, {score: 7})" class="w-full p-4 border-2 rounded-xl text-left hover:bg-gray-50 font-medium focus:outline-none focus:ring-2 focus:ring-blue-200">ìì£¼ ì†Œí†µí•˜ëŠ” ì§ì¥ ë™ë£Œ/ì¹œêµ¬</button>
                    <button type="button" onclick="nextStep(2, {score: 4})" class="w-full p-4 border-2 rounded-xl text-left hover:bg-gray-50 font-medium focus:outline-none focus:ring-2 focus:ring-blue-200">ê°€ë” ì—°ë½í•˜ëŠ” ì§€ì¸</button>
                    <button type="button" onclick="nextStep(2, {score: 1})" class="w-full p-4 border-2 rounded-xl text-left hover:bg-gray-50 font-medium focus:outline-none focus:ring-2 focus:ring-blue-200">ì—°ë½ì´ ëœ¸í–ˆë˜ ë™ì°½/ë™ë£Œ</button>
                </div>
                <button type="button" onclick="prevStep(2)" class="w-full mt-6 py-3 border rounded-2xl text-gray-600 font-semibold hover:bg-gray-50 transition-all focus:outline-none focus:ring-2 focus:ring-blue-200">ì´ì „</button>
            </div>

            <div id="step3" class="step-content">
                <h2 class="text-2xl font-bold mb-6">ìƒì„¸ ìƒí™©ì„ ì•Œë ¤ì£¼ì„¸ìš”.</h2>
                <div class="space-y-6">
                    <div>
                        <p id="pplLabel" class="text-sm font-semibold text-gray-700 mb-3">ë™í–‰ ì¸ì› (ë³¸ì¸ í¬í•¨)</p>
                        <div class="grid grid-cols-3 gap-2" id="pplGroup">
                            <button type="button" onclick="setExtra('ppl', 1, this)" class="extra-btn py-3 border rounded-xl active focus:outline-none focus:ring-2 focus:ring-blue-200">1ëª…</button>
                            <button type="button" onclick="setExtra('ppl', 2, this)" class="extra-btn py-3 border rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-200">2ëª…</button>
                            <button type="button" onclick="setExtra('ppl', 3, this)" class="extra-btn py-3 border rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-200">3ëª…</button>
                            <button type="button" onclick="setExtra('ppl', 4, this)" class="extra-btn py-3 border rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-200">4ëª…</button>
                            <button type="button" onclick="setExtra('ppl', 5, this)" class="extra-btn py-3 border rounded-xl col-span-2 focus:outline-none focus:ring-2 focus:ring-blue-200">5ëª… ì´ìƒ (ê°€ì¡±)</button>
                        </div>
                    </div>
                    <div>
                        <p id="eatLabel" class="text-sm font-semibold text-gray-700 mb-3">ì‹ì‚¬ ì—¬ë¶€</p>
                        <div class="flex gap-2">
                            <button type="button" onclick="setExtra('eat', 'yes', this)" class="extra-btn flex-1 py-3 border rounded-xl active focus:outline-none focus:ring-2 focus:ring-blue-200">ì‹ì‚¬ í•¨</button>
                            <button type="button" onclick="setExtra('eat', 'no', this)" class="extra-btn flex-1 py-3 border rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-200">ì•ˆ í•¨ / ë‹µë¡€í’ˆ</button>
                        </div>
                    </div>
                    <button type="button" onclick="showResult()" class="w-full py-4 bg-blue-600 text-white rounded-2xl font-bold mt-4 shadow-lg active:scale-95 transition-all focus:outline-none focus:ring-2 focus:ring-blue-200">ê³„ì‚° ê²°ê³¼ ë³´ê¸°</button>
                    <button type="button" onclick="prevStep(3)" class="w-full py-3 border rounded-2xl text-gray-600 font-semibold hover:bg-gray-50 transition-all focus:outline-none focus:ring-2 focus:ring-blue-200">ì´ì „</button>
                </div>
            </div>

            <div id="resultStep" class="step-content text-center">
                <div class="py-10">
                    <p class="text-gray-500 font-medium mb-2">ê°€ì¥ ì ì ˆí•œ ê¸ˆì•¡ì€</p>
                    <div class="text-6xl font-black text-blue-600 mb-2" aria-live="polite"><span id="totalAmount">0</span>ë§Œì›</div>
                    <p id="rangeText" class="text-sm text-gray-500 mb-6"></p>
                    <div id="analysisBox" class="bg-blue-50 p-5 rounded-2xl text-left text-sm text-blue-800 leading-relaxed"></div>
                    <p class="text-[11px] text-gray-400 mt-4 leading-relaxed">
                        ì°¸ê³ : ì§€ì—­/ì‹ëŒ€/ê´€ê³„/íšŒì‚¬ ê´€í–‰ì— ë”°ë¼ ë‹¬ë¼ì§ˆ ìˆ˜ ìˆì–´ìš”. ë¬´ë¦¬í•˜ì§€ ì•ŠëŠ” ì„ ì—ì„œ ì¡°ì •í•˜ì„¸ìš”.
                    </p>
                </div>
                <button type="button" onclick="location.reload()" class="w-full py-3 text-gray-400 font-medium hover:text-gray-600 transition-colors focus:outline-none focus:ring-2 focus:ring-blue-200">ì²˜ìŒë¶€í„° ë‹¤ì‹œ í•˜ê¸°</button>
            </div>
        </div>
    </div>

    <script>
        let userData = { event: '', score: 0, ppl: 1, eat: 'yes' };
        let currentStep = 1;
        const TOTAL_STEPS = 4; // step1~step3 + result

        function updateProgress(step) {
            const pct = (step / TOTAL_STEPS) * 100;
            document.getElementById('progressBar').style.width = pct + '%';
        }

        function updateStepCounter(step) {
            const el = document.getElementById('stepCounter');
            if (!el) return;
            if (step >= 4) el.innerText = 'ì™„ë£Œ';
            else el.innerText = `${step}/3`;
        }

        function goToStep(step) {
            currentStep = step;
            document.querySelectorAll('.step-content').forEach(s => s.classList.remove('active'));
            if (step >= 4) document.getElementById('resultStep').classList.add('active');
            else document.getElementById(`step${step}`).classList.add('active');
            updateProgress(step >= 4 ? 4 : step);
            updateStepCounter(step);
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function nextStep(current, data) {
            userData = { ...userData, ...data };
            if (current === 2) updateStep3UI();
            goToStep(current + 1);
        }

        function prevStep(current) {
            const target = Math.max(1, current - 1);
            goToStep(target);
        }

        function setExtra(key, val, el) {
            userData[key] = val;
            const parent = el.parentElement;
            parent.querySelectorAll('.extra-btn').forEach(btn => btn.classList.remove('active'));
            el.classList.add('active');
        }

        function updateStep3UI() {
            const { event } = userData;
            const eatLabel = document.getElementById('eatLabel');
            const pplLabel = document.getElementById('pplLabel');
            if (!eatLabel || !pplLabel) return;

            if (event === 'funeral') {
                pplLabel.innerText = 'ë™í–‰ ì¸ì› (ë³¸ì¸ í¬í•¨)';
                eatLabel.innerText = 'ì‹ì‚¬/ì ‘ê° ì—¬ë¶€';
            } else if (event === 'baby') {
                pplLabel.innerText = 'ë™í–‰ ì¸ì› (ë³¸ì¸ í¬í•¨)';
                eatLabel.innerText = 'ì‹ì‚¬ ì—¬ë¶€';
            } else {
                pplLabel.innerText = 'ë™í–‰ ì¸ì› (ë³¸ì¸ í¬í•¨)';
                eatLabel.innerText = 'ì‹ì‚¬ ì—¬ë¶€';
            }
        }

        function showResult() {
            const { event, score, ppl, eat } = userData;
            if (!event || !score) return;

            // 1) ê´€ê³„ ê¸°ë°˜ ê¸°ë³¸ ê¸ˆì•¡ (ë§Œì›)
            let baseAmount = 5;
            if (score >= 10) baseAmount = 20;
            else if (score >= 7) baseAmount = 10;
            else if (score >= 4) baseAmount = 7;
            else baseAmount = 5;

            // 2) í–‰ì‚¬ë³„ ê¸°ë³¸ ë³´ì • (ê³¼ë„í•œ ì¶”ì²œ ë°©ì§€)
            // - ëŒì”ì¹˜: ê²°í˜¼ì‹ ëŒ€ë¹„ í•œ ë‹¨ê³„ ë‚®ê²Œ
            // - ì¥ë¡€ì‹: ê´€ê³„ê°€ ì•„ì£¼ ê°€ê¹Œì›Œë„ ìƒí•œì„ ë‹¤ì†Œ ë³´ìˆ˜ì ìœ¼ë¡œ
            if (event === 'baby') baseAmount = Math.max(5, baseAmount - 2);
            if (event === 'funeral') baseAmount = Math.min(baseAmount, 15);

            // 3) ì‹ì‚¬/ì ‘ê°(ì¸ì›) ë³´ì •
            let finalAmount = baseAmount;
            const mealCost = event === 'baby' ? 5 : event === 'funeral' ? 3 : 7;

            if (eat === 'yes') {
                // ë‹¤ì¸ì› ê³„ì‚°: (ì¸ì›ìˆ˜ * ì‹ëŒ€/ì ‘ê°ë¹„)ë³´ë‹¤ ì ìœ¼ë©´ ê·¸ ìˆ˜ì¤€ìœ¼ë¡œ ë³´ì •
                const totalMealCost = ppl * mealCost;
                finalAmount = Math.max(finalAmount, totalMealCost);

                // ê²°í˜¼ì‹ì€ ì‹ì‚¬ ë™ë°˜ ì‹œ 'ì§€ì¸ê¸‰ ì´ìƒ' ìµœì†Œ í•˜í•œì„ ë‘ 
                if (event === 'wedding' && score >= 4) finalAmount = Math.max(finalAmount, 10);
            } else {
                // ì‹ì‚¬/ì ‘ê°ì´ ì—†ìœ¼ë©´(ë˜ëŠ” ë‹µë¡€í’ˆ) ë„ˆë¬´ í° ê²½ìš°ë§Œ ë³´ìˆ˜ì ìœ¼ë¡œ ì¡°ì •
                if (finalAmount >= 15) finalAmount -= 2;
            }

            // 4) 5ë§Œì› ë‹¨ìœ„ ì ˆìƒ
            finalAmount = Math.ceil(finalAmount / 5) * 5;

            // ê²°ê³¼ í™”ë©´ ì—…ë°ì´íŠ¸
            document.getElementById('totalAmount').innerText = finalAmount;

            const minRange = Math.max(5, finalAmount - 5);
            const maxRange = finalAmount + 5;
            document.getElementById('rangeText').innerText = `ì¶”ì²œ ë²”ìœ„: ${minRange}~${maxRange}ë§Œì›`;

            const lines = [];
            if (event === 'wedding') {
                lines.push('ìµœê·¼ ê³ ë¬¼ê°€/í‰ê·  ì‹ëŒ€ë¥¼ ë°˜ì˜í•´ ê³„ì‚°í–ˆì–´ìš”.');
                if (eat === 'yes') lines.push(`${ppl}ëª… ê¸°ì¤€ ì‹ì‚¬ ë¹„ìš©ì„ ê°ì•ˆí–ˆì–´ìš”.`);
                else lines.push('ì‹ì‚¬/ë‹µë¡€í’ˆ ì—¬ë¶€ë¥¼ ë°˜ì˜í•´ ë³´ìˆ˜ì ìœ¼ë¡œ ì¡°ì •í–ˆì–´ìš”.');
            } else if (event === 'baby') {
                lines.push('ê²°í˜¼ì‹ ëŒ€ë¹„ í•œ ë‹¨ê³„ ë‚®ì€ ê¸°ì¤€ìœ¼ë¡œ ì¶”ì²œí–ˆì–´ìš”.');
                if (eat === 'yes') lines.push(`${ppl}ëª… ê¸°ì¤€ ë·”í˜ ë¹„ìš©ì„ ê°ì•ˆí–ˆì–´ìš”.`);
                else lines.push('ì‹ì‚¬/ë‹µë¡€í’ˆ ì—¬ë¶€ë¥¼ ë°˜ì˜í•´ ë³´ìˆ˜ì ìœ¼ë¡œ ì¡°ì •í–ˆì–´ìš”.');
            } else {
                lines.push('ì¡°ì˜ì˜ ì˜ˆìš°ë¥¼ ìš°ì„ í•˜ëŠ” ë°©í–¥ìœ¼ë¡œ ê³¼ë„í•œ ì¶”ì²œì„ í”¼í–ˆì–´ìš”.');
                if (eat === 'yes') lines.push(`${ppl}ëª… ê¸°ì¤€ ì ‘ê°/ì‹ì‚¬ ë¹„ìš©ì„ ì¼ë¶€ ê°ì•ˆí–ˆì–´ìš”.`);
            }
            lines.push('ë§ˆì§€ë§‰ìœ¼ë¡œ 5ë§Œì› ë‹¨ìœ„ë¡œ ì •ë¦¬í–ˆì–´ìš”.');

            document.getElementById('analysisBox').innerHTML =
                `<ul class="list-disc pl-5 space-y-1">${lines.map(t => `<li>${t}</li>`).join('')}</ul>`;

            goToStep(4);
        }
    </script>
</body>
</html>
